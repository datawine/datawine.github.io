<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="smartnic," />










<meta name="description" content="总结smartNIC的相关知识，虽然没啥用（因为很多东西都是基于netdev interface，而实验上好像是虚拟端口，所以不是一个东西），但是为了以后可能会用，还是记一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="smartnic学习">
<meta property="og:url" content="https://datawine.github.io/smartnic-learning.html">
<meta property="og:site_name" content="Datawine&#39;s Blog">
<meta property="og:description" content="总结smartNIC的相关知识，虽然没啥用（因为很多东西都是基于netdev interface，而实验上好像是虚拟端口，所以不是一个东西），但是为了以后可能会用，还是记一下。">
<meta property="og:locale">
<meta property="article:published_time" content="2022-05-07T14:43:02.000Z">
<meta property="article:modified_time" content="2022-05-07T14:43:57.532Z">
<meta property="article:author" content="Datawine">
<meta property="article:tag" content="smartnic">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://datawine.github.io/smartnic-learning.html"/>





  <title>smartnic学习 | Datawine's Blog</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Datawine's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://datawine.github.io/smartnic-learning.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Datawine's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">smartnic学习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-05-07T22:43:02+08:00">
                2022-05-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/smartnic-learning.html#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="smartnic-learning.html" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o">本文总阅读量</i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>总结smartNIC的相关知识，虽然没啥用（因为很多东西都是基于netdev
interface，而实验上好像是虚拟端口，所以不是一个东西），但是为了以后可能会用，还是记一下。</p>
<span id="more"></span>
<h1 id="agilio-smartnic-user-guide">Agilio smartNIC user guide</h1>
<p>文档地址https://help.netronome.com/support/solutions/articles/36000049975-basic-firmware-user-guide</p>
<h2 id="hardware-installation">hardware installation</h2>
<h3 id="validation">validation</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lspci -d 19ee:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">lspci | grep -i Eth</span><br></pre></td></tr></table></figure>
<h2 id="driver-and-firmware">driver and firmware</h2>
<h3 id="validating-the-driver">validating the driver</h3>
<p>支持nfp driver的操作系统</p>
<table>
<thead>
<tr class="header">
<th>operating system</th>
<th>kernel version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ubuntu 16.04</td>
<td>4.11+(PF)</td>
</tr>
<tr class="even">
<td>RHEL 7.4+</td>
<td>Default</td>
</tr>
<tr class="odd">
<td>CentOS 7.4+</td>
<td>Default</td>
</tr>
</tbody>
</table>
<h4 id="confirm-upstreamed-nfp-driver">confirm upstreamed nfp
driver</h4>
<p>Confirm that your current Operating System contains the upstreamed
nfp module</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo nfp | head -3</span><br></pre></td></tr></table></figure>
<h4 id="confirm-thath-nfp-driver-is-loaded">confirm thath nfp driver is
loaded</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmode | grep nfp</span><br></pre></td></tr></table></figure>
<h3 id="smartnic-netdev-interfaces">smartNIC netdev interfaces</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install agilio-nameing-policy package</span></span><br><span class="line">apt-get install agilio-naming-policy</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nfp driver初始化之后就有新的netdev interfaces了</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ip <span class="built_in">link</span></span></span><br></pre></td></tr></table></figure>
<h3 id="validating-the-firmware">validating the firmware</h3>
<p>固件的版本和smartNIC能实现的功能有关，固件应该在<code>/lib/firmware/netronome/</code></p>
<p>固件版本可以通过</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ethtool -i <span class="string">&quot;netdev interface&quot;</span></span></span><br><span class="line">ethtool -i enp6s0np0</span><br></pre></td></tr></table></figure>
<h3 id="upgrading-the-firmware">upgrading the firmware</h3>
<h4 id="upgrading-firmware-via-the-netronome-repo">upgrading firmware
via the netronome repo</h4>
<p>通过附录一的配置之后，就可以这样安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install agilio-nic-firmware</span><br></pre></td></tr></table></figure>
<h4 id="upgrading-firmware-from-package-installation">upgrading firmware
from package installation</h4>
<p>从support上下载之后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i agilio-nic-firmware-*.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">reload driver to load new firmware</span></span><br><span class="line">rmmod nfp; modprobe nfp</span><br></pre></td></tr></table></figure>
<h2 id="using-the-linux-driver">using the linux driver</h2>
<h3 id="configuring-interface-media-mode">configuring interface media
mode</h3>
<p>对于老的内核不支持这样配置的，见附录C</p>
<h4 id="configuring-interface-link-speed">configuring interface
link-speed</h4>
<p>下面是agilio CX 25G smartNIC的示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># down respective interface(s)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip <span class="built_in">link</span> <span class="built_in">set</span> &lt;intf&gt; down</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># to set interface linkspeed to 10G</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -s &lt;intf&gt; speed 10000</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#NB. A driver reload is needed whenever a port’s speed is changed</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># reload driver for changes to take effect</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rmmod nfp; modprobe nfp</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># to set interface linkspeed to 25G</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -s &lt;intf&gt; speed 25000</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># reload driver for changes to take effect</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rmmod nfp; modprobe nfp</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># older driver/firmware may require a system reboot for changes to take effect</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">reboot</span></span><br></pre></td></tr></table></figure>
<h4 id="setting-interface-breakout-mode">setting interface breakout
mode</h4>
<p>下面的命令只适用于kernel版本4.13之后，为Agilio CX 40G/2x40G
SmartNICs的示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># determine card’s pci address</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lspci -kd 19ee:</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># devlink dev show</span></span></span><br><span class="line">pci/0000:06:00.0</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># devlink port</span></span></span><br><span class="line">pci/0000:06:00.0/0: type eth netdev enp6s0np0</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># to put the first 40G port in breakout mode(4x10G)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">devlink port <span class="built_in">split</span> pci/0000:06:00.0/0 count 4</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># to configure the second 40G port on a beryllium(2x40G interfaces) in breakout mode(4x10G)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">devlink port <span class="built_in">split</span> pci/0000:06:00.0/4 count 4</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># to configure a port from breakout mode(4x10G) to single mode(40G)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">devlink port unsplit pci/0000:06:00.0/4</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># reload driver for changes to take effect</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rmmod nfp; modprobe nfp</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># older driver/firmware versions may require a system reboot for changes to take effect</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">reboot</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># after reboot the port should be in breakout mode e.g.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">devlink port</span></span><br><span class="line">pci/0000:06:00.0/0: type eth netdev enp6s0np0s0 split_group 0</span><br><span class="line">pci/0000:06:00.0/1: type eth netdev enp6s0np0s1 split_group 0</span><br><span class="line">pci/0000:06:00.0/2: type eth netdev enp6s0np0s2 split_group 0</span><br><span class="line">pci/0000:06:00.0/3: type eth netdev enp6s0np0s3 split_group 0</span><br></pre></td></tr></table></figure>
<h3 id="confirm-connectivity">confirm connectivity</h3>
<h4 id="allocating-ip-addresses">allocating IP addresses</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># assign IP address to interface</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip address add 10.0.0.2/24 dev ens1np0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip <span class="built_in">link</span> <span class="built_in">set</span> ens1np0 up</span></span><br></pre></td></tr></table></figure>
<h4 id="pinging-interfaces">pinging interfaces</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ping IP from host on same subnet</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ping 10.0.0.2</span></span><br><span class="line"></span><br><span class="line">PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=0.067 ms</span><br><span class="line">64 bytes from 10.0.0.2: icmp_seq=4 ttl=64 time=0.062 ms</span><br></pre></td></tr></table></figure>
<h2 id="basic-performance-test">basic performance test</h2>
<p>除了IRQ和RSS的配置之外，就是iperf和iperf3的一些基本用法</p>
<h3 id="set-irq-affinity">set IRQ affinity</h3>
<p>IRQ用来平衡核之间的负载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wget https://raw.githubusercontent.com/Netronome/nfp-drv-kmods/master/tools/set_irq_affinity.sh</span></span><br></pre></td></tr></table></figure>
<p>样例输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/nfp-drv-kmods/tools/set_irq_affinity.sh enXXXXnpX</span></span><br><span class="line"></span><br><span class="line">Device 0000:02:00.0 is on node 0 with cpus 0 1 2 3 4 5 6 7 8 9 20 21 22 23 24 25 26 27 28 29</span><br><span class="line">IRQ 181 to CPU 0     (irq: 00,00000001 xps: 03,00030003)</span><br><span class="line">IRQ 182 to CPU 1     (irq: 00,00000002 xps: 00,00000000)</span><br><span class="line">IRQ 183 to CPU 2     (irq: 00,00000004 xps: 0c,000c000c)</span><br><span class="line">IRQ 184 to CPU 3     (irq: 00,00000008 xps: 00,00000000)</span><br><span class="line">IRQ 185 to CPU 4     (irq: 00,00000010 xps: 30,00300030)</span><br><span class="line">IRQ 186 to CPU 5     (irq: 00,00000020 xps: 00,00000000)</span><br><span class="line">IRQ 187 to CPU 6     (irq: 00,00000040 xps: c0,00c000c0)</span><br><span class="line">IRQ 188 to CPU 7     (irq: 00,00000080 xps: 00,00000000)</span><br></pre></td></tr></table></figure>
<h3 id="install-iperf">install iperf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y iperf</span><br></pre></td></tr></table></figure>
<h3 id="using-iperf">using iperf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># server</span></span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">allocate ipv4 address to SmartNIC interface</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip address add 10.0.0.1/24 dev ens1np0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">launch iperf server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iperf -s</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># client</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iperf -c 10.0.0.1 -P 4</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> iperf -c 10.0.0.1 -P 4</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Client connecting to 10.1, TCP port 5001</span><br><span class="line">TCP window size: 85.0 KByte (default)</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">[  5] local 10.0.0.2 port 56938 connected with 10.0.0.1 port 5001</span><br><span class="line">[  3] local 10.0.0.2 port 56932 connected with 10.0.0.1 port 5001</span><br><span class="line">[  4] local 10.0.0.2 port 56934 connected with 10.0.0.1 port 5001</span><br><span class="line">[  6] local 10.0.0.2 port 56936 connected with 10.0.0.1 port 5001</span><br><span class="line">[ ID] Interval       Transfer     Bandwidth</span><br><span class="line">[  6]  0.0-10.0 sec  11.9 GBytes  10.3 Gbits/sec</span><br><span class="line">[  3]  0.0-10.0 sec  9.85 GBytes  8.46 Gbits/sec</span><br><span class="line">[  4]  0.0-10.0 sec  11.9 GBytes  10.2 Gbits/sec</span><br><span class="line">[  5]  0.0-10.0 sec  10.2 GBytes  8.75 Gbits/sec</span><br><span class="line">[SUM] 0.0-10.0 sec  43.8 GBytes  37.7 Gbits/sec</span><br></pre></td></tr></table></figure>
<h3 id="using-iperf3">using iperf3</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Server:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iperf3 -s -p 5001 &amp; iperf3 -s -p 5002 &amp; iperf3 -s -p 5003 &amp; iperf3 -s -p 5004 &amp;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Client:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iperf3 -c 102.0.0.6 -i 30 -p 5001 &amp; iperf3 -c 102.0.0.6 -i 30 -p 5002 &amp; iperf3 -c 102.0.0.6 -i 30 -p 5003 &amp; iperf3 -c 102.0.0.6 -i 30 -p 5004 &amp;</span></span><br><span class="line"></span><br><span class="line">Example output:</span><br><span class="line"></span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  9.39 GBytes  8.03 Gbits/sec                  receiver</span><br><span class="line">[  5]  10.00-10.04  sec  33.1 MBytes  7.77 Gbits/sec                 </span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  9.86 GBytes  8.44 Gbits/sec                  receiver</span><br><span class="line">[  5]  10.00-10.04  sec  53.6 MBytes  11.8 Gbits/sec                 </span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  11.9 GBytes  10.2 Gbits/sec                  receiver</span><br><span class="line">[  5]  10.00-10.04  sec  42.1 MBytes  9.43 Gbits/sec                 </span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth</span><br><span class="line">[  5]   0.00-10.04  sec  0.00 Bytes  0.00 bits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  10.2 GBytes  8.70 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">Total: 37.7 Gbits/sec</span><br><span class="line"></span><br><span class="line">95.49% of 40GbE link</span><br></pre></td></tr></table></figure>
<h2 id="basic-firmware-features">basic firmware features</h2>
<p>这节主要介绍用ethtool查看和配置一些smartNIC的接口参数。</p>
<h3 id="multiple-queues">multiple queues</h3>
<p>smartNIC支持多个TX和RX队列。<code>-I</code>可以看到当前的队列，<code>-L</code>可以配置当前的队列。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -l ens1np0</span></span><br><span class="line">Channel parameters for ens1np0:</span><br><span class="line">Pre-set maximums:</span><br><span class="line">RX:             20</span><br><span class="line">TX:             20</span><br><span class="line">Other:          2</span><br><span class="line">Combined:       20</span><br><span class="line">Current hardware settings:</span><br><span class="line">RX:             0</span><br><span class="line">TX:             12</span><br><span class="line">Other:          2</span><br><span class="line">Combined:       8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -L &lt;intf&gt; rx 0 tx 0 combined 8</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># rx 代表receive ring interrupts</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># tx 代表transmit ring interrupts</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># combined 代表interrupts that service both</span></span></span><br></pre></td></tr></table></figure>
<h3 id="receive-side-scalingrss">receive side scaling(RSS)</h3>
<p><code>-n</code>查看，<code>-N</code>修改，<code>-x</code>和<code>-X</code>修改和配置key</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -n ens1np0 rx-flow-hash tcp4</span></span><br><span class="line">TCP over IPV4 flows use these fields for computing Hash flow key:</span><br><span class="line">IP SA</span><br><span class="line">IP DA</span><br><span class="line">L4 bytes 0 &amp; 1 [TCP/UDP src port]</span><br><span class="line">L4 bytes 2 &amp; 3 [TCP/UDP dst port]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -n ens1np0 rx-flow-hash udp4</span></span><br><span class="line">UDP over IPV4 flows use these fields for computing Hash flow key:</span><br><span class="line">IP SA</span><br><span class="line">IP DA</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -N &lt;intf&gt; rx-flow-hash tcp4 sdfn</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -N &lt;intf&gt; rx-flow-hash udp4 sdfn</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># flag details</span></span></span><br><span class="line">rx-flow-hash tcp4|udp4|ah4|esp4|sctp4|tcp6|udp6|ah6|esp6|sctp6m|v|t|s|d|f|n|r...</span><br><span class="line">                  Configures the hash options for the specified flow type.</span><br><span class="line"> </span><br><span class="line">                  m   Hash on the Layer 2 destination address of the rx packet.</span><br><span class="line">                  v   Hash on the VLAN tag of the rx packet.</span><br><span class="line">                  t   Hash on the Layer 3 protocol field of the rx packet.</span><br><span class="line">                  s   Hash on the IP source address of the rx packet.</span><br><span class="line">                  d   Hash on the IP destination address of the rx packet.</span><br><span class="line">                  f   Hash on bytes 0 and 1 of the Layer 4 header of the rx packet.</span><br><span class="line">                  n   Hash on bytes 2 and 3 of the Layer 4 header of the rx packet.</span><br><span class="line">                  r   Discard  all  packets  of this flow type. When this option is set, all other options are ignored.</span><br><span class="line">                      </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -x &lt;intf&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -X &lt;intf&gt; &lt;hkey&gt;</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># flag details</span></span></span><br><span class="line">-x --show-rxfh-indir</span><br><span class="line">Retrieves the receive flow hash indirection table.</span><br><span class="line">-X --set-rxfh-indir</span><br><span class="line">Configures the receive flow hash indirection table.</span><br></pre></td></tr></table></figure>
<h3 id="view-interface-parameters">view interface parameters</h3>
<p><code>-k</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -k ens1np0</span></span><br></pre></td></tr></table></figure>
<p>一些选项开关列举如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># rx-checksumming</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">enable</span> rx-checksumming</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -K ens1np0 rx on</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">disable</span> rx-checksumming</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ethtool -K ens1np0 rx off</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#同理</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># tx-checksumming: tx</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># scatter and gather: sg</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># tcp-segmentation offload: tso</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># generic segmentation offload: gso</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># generic receive offload: gro</span></span></span><br></pre></td></tr></table></figure>
<h2 id="install-configuring-and-using-dpdk">install configuring and
using dpdk</h2>
<p>此处就略过了。</p>
<h2 id="附录内容">附录内容</h2>
<ul>
<li>A：netronome repositories，装上面提到的一些应用</li>
<li>B：安装out-of-tree NFP Driver</li>
<li>C：使用BSP package（上面提到了kernel较老的时候如何configure
interface）</li>
<li>D：使用dpdk-ns</li>
<li>E：updating flash</li>
<li>F：升级kernel</li>
<li>G：set_irq_affinity.sh Source（前面irq的替代脚本）</li>
</ul>
<h1 id="key-schedule">key schedule</h1>
<p>https://github.com/goodnighthy/KeySched/tree/master/key_schedule</p>
<h2
id="starting-and-stopping-using-upstartubuntu-14.04-and-centos-6">starting
and stopping using upstart(ubuntu 14.04 and centos 6)</h2>
<p>The RTE (NORMAL MODE) can be started/stopped by calling: start/stop
nfp-sdk6-rte</p>
<p>The RTE(DEBUG MODE) can be started/stopped by calling: start/stop
nfp-sdk6-rte-debug</p>
<p>The RTE(SIM MODE) can be started by calling: start/stop
nfp-sdk6-rte-sim Before using this Upstart configuration set NETRODIR to
the SDK6 simulator installation directory in the installed file
nfp-sdk6-rte-sim.conf</p>
<p>The Hardware Debug Server can be started by calling: start/stop
nfp-hwdbg-srv</p>
<p>To start the job at system ready uncomment the startup line in
nfp-sdk6-rte.conf, nfp-sdk6-rte-debug.conf or nfp-hwdbg-srv.conf in
/etc/init/.</p>
<p>To check whether the RTE job started correctly and is still running
use: status nfp-sdk6-rte (add -debug for DEBUG MODE or -sim for SIM
MODE) if the status show stop/waiting the RTE has stopped and an error
probably occurred. Look at either the Upstart job log in
/var/log/upstart/nfp-sdk6-rte.log (replace nfp-sdk6-rte with the job
name you started) or look in /var/log/nfp-sdk-rte.log for RTE only logs.
To have a continuous live log open either log with tail -f
<log_file_name>.log</p>
<h2
id="starting-and-stopping-using-systemdubuntu-16.04-and-centosrhel-7">starting
and stopping using systemd(ubuntu 16.04 and centos/rhel 7)</h2>
<p>The RTE (NORMAL MODE) can be started/stopped by calling: systemctl
start/stop nfp-sdk6-rte</p>
<p>The RTE(DEBUG MODE) can be started/stopped by calling: systemctl
start/stop pnfp-sdk6-rte-debug</p>
<p>The RTE(SIM MODE) can be started/stopped by calling: systemctl
start/stop nfp-sdk6-rte-sim Before using this Upstart configuration set
NETRODIR to the SDK6 simulator installation directory in the file
/usr/lib/systemd/system/nfp-sdk6-rte-sim.service</p>
<p>The Hardware Debug Server can be started/stopped by calling:
systemctl start/stop nfp-hwdbg-srv</p>
<p>To start the programs at system startup run the systemctl enable
command for the specified service: systemctl enable
nfp-sdk6-rte.service</p>
<p>To check whether the RTE service started correctly and is still
running use: systemctl status nfp-sdk6-rte (add -debug for DEBUG MODE or
-sim for SIM MODE) if the Active status show inactive (dead) the RTE has
stopped and an error probably occurred. Look at either the Systemd
journal or in the RTE logs for more detail on what error occurred.</p>
<p>For looking in the Systemd journal use the following command:
journalctl -u nfp-sdk6-rte replace nfp-sdk6-rte with the service name
you are using (ex nfp-sdk6-rte-debug or nfp-sdk6-rte-sim). Add the -f
argument to follow the journal for a live log.</p>
<p>For only logs generated by the RTE look /var/log/nfp-sdk-rte.log, for
continuous live log open the log with tail -f
/var/log/nfp-sdk-rte.log</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/smartnic/" rel="tag"># smartnic</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/matplotlib-chinese-font.html" rel="next" title="如何在matplotlib中使用中文">
                <i class="fa fa-chevron-left"></i> 如何在matplotlib中使用中文
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ycsb-learning.html" rel="prev" title="ycsb学习">
                ycsb学习 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7Carchive">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/datawine" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#agilio-smartnic-user-guide"><span class="nav-number">1.</span> <span class="nav-text">Agilio smartNIC user guide</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hardware-installation"><span class="nav-number">1.1.</span> <span class="nav-text">hardware installation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#validation"><span class="nav-number">1.1.1.</span> <span class="nav-text">validation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#driver-and-firmware"><span class="nav-number">1.2.</span> <span class="nav-text">driver and firmware</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#validating-the-driver"><span class="nav-number">1.2.1.</span> <span class="nav-text">validating the driver</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#confirm-upstreamed-nfp-driver"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">confirm upstreamed nfp
driver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#confirm-thath-nfp-driver-is-loaded"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">confirm thath nfp driver is
loaded</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#smartnic-netdev-interfaces"><span class="nav-number">1.2.2.</span> <span class="nav-text">smartNIC netdev interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#validating-the-firmware"><span class="nav-number">1.2.3.</span> <span class="nav-text">validating the firmware</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#upgrading-the-firmware"><span class="nav-number">1.2.4.</span> <span class="nav-text">upgrading the firmware</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#upgrading-firmware-via-the-netronome-repo"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">upgrading firmware
via the netronome repo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#upgrading-firmware-from-package-installation"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">upgrading firmware
from package installation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#using-the-linux-driver"><span class="nav-number">1.3.</span> <span class="nav-text">using the linux driver</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#configuring-interface-media-mode"><span class="nav-number">1.3.1.</span> <span class="nav-text">configuring interface media
mode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#configuring-interface-link-speed"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">configuring interface
link-speed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setting-interface-breakout-mode"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">setting interface breakout
mode</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#confirm-connectivity"><span class="nav-number">1.3.2.</span> <span class="nav-text">confirm connectivity</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#allocating-ip-addresses"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">allocating IP addresses</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pinging-interfaces"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">pinging interfaces</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#basic-performance-test"><span class="nav-number">1.4.</span> <span class="nav-text">basic performance test</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#set-irq-affinity"><span class="nav-number">1.4.1.</span> <span class="nav-text">set IRQ affinity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#install-iperf"><span class="nav-number">1.4.2.</span> <span class="nav-text">install iperf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#using-iperf"><span class="nav-number">1.4.3.</span> <span class="nav-text">using iperf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#using-iperf3"><span class="nav-number">1.4.4.</span> <span class="nav-text">using iperf3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#basic-firmware-features"><span class="nav-number">1.5.</span> <span class="nav-text">basic firmware features</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#multiple-queues"><span class="nav-number">1.5.1.</span> <span class="nav-text">multiple queues</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#receive-side-scalingrss"><span class="nav-number">1.5.2.</span> <span class="nav-text">receive side scaling(RSS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#view-interface-parameters"><span class="nav-number">1.5.3.</span> <span class="nav-text">view interface parameters</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#install-configuring-and-using-dpdk"><span class="nav-number">1.6.</span> <span class="nav-text">install configuring and
using dpdk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95%E5%86%85%E5%AE%B9"><span class="nav-number">1.7.</span> <span class="nav-text">附录内容</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#key-schedule"><span class="nav-number">2.</span> <span class="nav-text">key schedule</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#starting-and-stopping-using-upstartubuntu-14.04-and-centos-6"><span class="nav-number">2.1.</span> <span class="nav-text">starting
and stopping using upstart(ubuntu 14.04 and centos 6)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#starting-and-stopping-using-systemdubuntu-16.04-and-centosrhel-7"><span class="nav-number">2.2.</span> <span class="nav-text">starting
and stopping using systemd(ubuntu 16.04 and centos&#x2F;rhel 7)</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Datawine</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">25.2k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">本站访客数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">本站总访问量</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cyw3QwzdC';
      var conf = 'cbf53c79ec118123e02b0e1a5676be66';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  









  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
